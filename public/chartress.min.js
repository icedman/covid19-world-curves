window.chartress=function(s,e){var a={};"undefined"!=typeof jQuery&&s instanceof jQuery&&(s=s[0]);var t=s;a.o=e,a.s={},a.log=function(s){a.o.debug===!0&&console.log(s)},a.clear=function(){a.draw.clear()};for(var l=function(s){return getComputedStyle(s)},i=function(s,e){return e-s},o=function(s){return"undefined"==typeof s},r=[["maxLength",null],["yMax",0],["fontFamily","Helvetica"],["class","chartress"],["type","line"],["graph"],["graph.padding"],["graph.padding.left",0],["graph.padding.right",0],["graph.padding.top",0],["graph.padding.bottom",0],["graph.redrawTimeout",5],["xAxis"],["xAxis.visible",!0],["xAxis.range"],["xAxis.range.from",0],["xAxis.range.to",null],["xAxis.legend"],["xAxis.legend.x"],["xAxis.legend.y"],["xAxis.lines"],["xAxis.lines.visible",!1],["xAxis.lines.color","rgba(0,0,0,.1)"],["xAxis.lines.width",1],["xAxis.label"],["xAxis.label.format",function(s){return s}],["xAxis.label.fontSize",14],["xAxis.label.markEvery",1],["xAxis.label.markCount",null],["xAxis.label.color","gray"],["xAxis.label.y",0],["xAxis.label.position","bottom"],["xAxis.label.size",14],["yAxis"],["yAxis.visible",!0],["yAxis.lines"],["yAxis.lines.visible",!0],["yAxis.lines.color","rgba(0,0,0,.1)"],["yAxis.lines.width",1],["yAxis.label"],["yAxis.label.format",function(s){return s}],["yAxis.label.fontSize",14],["yAxis.label.markEvery",null],["yAxis.label.markCount",4],["yAxis.label.color","gray"],["yAxis.label.x",0],["legend"],["legend.x",100],["legend.y",0],["legend.padding"],["legend.padding.top",0],["legend.padding.right",0],["legend.padding.bottom",0],["legend.padding.left",0],["columns"],["columns.width",40],["columns.space",1],["columns.labels"],["columns.labels.fontSize",16],["columns.labels.y",1],["pie"],["pie.total",null],["pie.title"],["pie.title.size",50],["pie.title.bold",!0],["pie.title.text",!1],["pie.title.pre"],["pie.title.pre.text",!1],["pie.title.pre.size",14],["pie.title.sub"],["pie.title.sub.text",!1],["pie.title.sub.size",14]],n=0;n<r.length;n++){var d=r[n][0].split("."),p={};o(r[n][1])||(p=r[n][1]),1===d.length&&(o(a.o[d[0]])?(a.o[d[0]]=p,a.s[d[0]]=p):a.s[d[0]]=a.o[d[0]]),2===d.length&&(o(a.o[d[0]][d[1]])?(a.o[d[0]][d[1]]=p,a.s[d[0]][d[1]]=p):a.s[d[0]][d[1]]=a.o[d[0]][d[1]]),3===d.length&&(o(a.o[d[0]][d[1]][d[2]])?(a.o[d[0]][d[1]][d[2]]=p,a.s[d[0]][d[1]][d[2]]=p):a.s[d[0]][d[1]][d[2]]=a.o[d[0]][d[1]][d[2]])}"line"===a.s.type&&(a.s.graph.padding={top:a.o.graph.padding.top||10,right:a.o.graph.padding.right||8,bottom:a.o.graph.padding.bottom||25,left:a.o.graph.padding.left||35}),"column"===a.s.type&&(a.s.graph.padding={top:a.o.graph.padding.top||25,right:a.o.graph.padding.right||0,bottom:a.o.graph.padding.bottom||25,left:a.o.graph.padding.left||35},a.s.xAxis.label.pos=a.o.xAxis.label.position||"top",a.s.xAxis.label.y=a.o.xAxis.label.y||-5);var g=document.createElement("div");t.appendChild(g),g.className=a.s["class"],g.style.height="100%",g.style.width="100%",a.draw=SVG(g).size("100%","100%").spof(),a.o.debug===!0&&(console.info("chartress debug enabled for "),console.info(g),console.info("Passed Data: "),console.info(a.o),console.log("------")),a.setBounds=function(){if("line"===a.s.type||"column"===a.s.type){var s=0;for(var e in a.o.dataset)!function(){var t=a.o.dataset[e],l=t.plot.slice(0);null!==a.s.maxLength&&l.length>a.s.maxLength&&(l.reverse(),l.length=a.s.maxLength,l.reverse()),l.length>s&&(s=l.length),t.__plot=l.slice(0),l.sort(i),a.s.yMax<l[0]&&(a.s.yMax=l[0])}();a.s.maxLength=s,null===a.s.xAxis.range.to&&(a.s.xAxis.range.to=s)}if("column"===a.s.type){a.s.largestcolumn=0;for(e in a.o.dataset)for(var t=a.o.dataset[e],o=0;o<t.__plot.length;o++){var r=t.__plot[o];a.s.largestcolumn<r&&(a.s.largestcolumn=r)}}if("pie"===a.s.type&&(a.s.pie.total=a.o.pie.total||!1,a.s.pie.total===!1))for(e in a.o.dataset){var n=a.o.dataset[e];a.s.pie.total+=n.value}a.s.outerWidth=parseInt(l(g).width,10),a.s.width=a.s.outerWidth-a.s.graph.padding.right-a.s.graph.padding.left,a.s.outerHeight=parseInt(l(g).height,10),a.s.height=a.s.outerHeight-a.s.graph.padding.top-a.s.graph.padding.bottom,a.s.rect={top:a.s.graph.padding.top,left:a.s.graph.padding.left,right:a.s.graph.padding.left+a.s.width,bottom:a.s.outerHeight-a.s.graph.padding.bottom},a.o.debug===!0},a.drawLabels=function(){null===a.s.yAxis.label.markEvery&&(a.s.yAxis.label.markEvery=Math.round(a.s.yMax/a.s.yAxis.label.markCount));var s,e=[];for(s=0;s<a.s.yMax+a.s.yAxis.label.markEvery;s++){var t=s%a.s.yAxis.label.markEvery;0===t&&s<=a.s.yMax&&e.push(s)}if(e[e.length-1]=a.s.yMax,a.s.yAxis.visible!==!1||a.s.yAxis.lines.visible!==!1)for(a.yLabels=a.draw.group().addClass(a.s["class"]+"__labels chartress__labels--yAxis"),a.yLines=a.draw.group().addClass(a.s["class"]+"__lines chartress__lines--yAxis"),a.s.yPoints=[],s=0;s<e.length;s++)!function(){var t=(1-e[s]/a.s.yMax*a.s.height)*-1+a.s.graph.padding.top,i=a.s.yAxis.label.fontSize;if(a.s.yAxis.lines.visible!==!1&&a.yLines.rect(a.s.width,a.s.yAxis.lines.width).fill(a.s.yAxis.lines.color).dy(t).dx(a.s.rect.left),a.s.yAxis.visible!==!1){var o=e[e.length-1-s];o=a.s.yAxis.label.format(o),o=o.toString();var r=a.yLabels.text(o).fill(a.s.yAxis.label.color).font({family:a.s.fontFamily,size:i}).dx(a.s.rect.left+a.s.yAxis.label.x).dy(t-i/3).addClass(a.s["class"]+"__labels__label chartress__labels__label--yAxis");r.dx(parseInt(l(r.node).width,10)*-1-10),r.dy(parseInt(l(r.node).height,10)/2*-1),a.s.yPoints.push(t-i/3)}}();var i=a.s.xAxis.range.to-a.s.xAxis.range.from;null!==a.s.maxLength&&(i=a.s.maxLength),a.s.xPoints=[];var o=0;if("column"===a.s.type&&(i++,o=a.s.width/i/2),a.s.xAxis.visible!==!1||a.s.xAxis.lines.visible!==!1){var r=0;for(a.s.xAxis.maxRangeLength&&(r=a.s.xAxis.maxRangeLength+1),a.xLabels=a.draw.group().addClass(a.s["class"]+"__labels chartress__labels--xAxis"),a.xLines=a.draw.group().addClass(a.s["class"]+"__lines chartress__lines--xAxis"),s=0;s<i;s++)!function(){var e=a.s.xAxis.range.from+s+r;e=a.s.xAxis.label.format(e),e=e.toString();var t=s/(i-1),l=a.s.width*t+a.s.graph.padding.left,n=a.s.rect.bottom+a.s.xAxis.label.y;"top"===a.s.xAxis.label.pos&&(n=a.s.rect.top-1.5*a.s.xAxis.label.size+a.s.xAxis.label.y),a.s.xAxis.lines.visible!==!1&&a.xLines.rect(a.s.xAxis.lines.width,a.s.height).fill(a.s.xAxis.lines.color).dx(l-Math.ceil(a.s.xAxis.lines.width/2)+1).dy(a.s.rect.top),s%a.s.xAxis.label.markEvery===0&&a.s.xAxis.visible!==!1&&a.xLabels.text(e).fill(a.s.xAxis.label.color).font({family:a.s.fontFamily,anchor:"middle",size:a.s.xAxis.label.fontSize}).dx(l+o).dy(n).addClass(a.s["class"]+"__labels__label chartress__labels--xAxis"),a.s.xPoints.push(l)}()}},a.drawLines=function(){a.draw_plots=a.draw.group().addClass(a.s["class"]+"__plots");for(var s in a.o.dataset){var e=a.o.dataset[s],t=e.classname||e.name.toLowerCase().replace(/ /g,"_"),l=e.color||"black",i=e.width||2,o=[];e.__plotgroup=a.draw_plots.group(),e.__plotgroup.addClass(a.s["class"]+"__plot chartress__plot--"+t).attr("plot-name",t);var r=0;for(var n in e.__plot)!function(){var s=e.__plot[n],t=r/(a.s.maxLength-1)*a.s.width+a.s.graph.padding.left,l=s/a.s.yMax*a.s.height;l=a.s.height-l+a.s.graph.padding.top,o.push([t,l]),r++}();e.__plotsvg=e.__plotgroup.polyline(o).fill("none").stroke({color:l,width:i}).addClass(a.s["class"]+"__line chartress__line--"+t),e.dash&&e.__plotsvg.attr("stroke-dasharray",e.dash);var d=e.rad||6;for(var p in o)!function(){var s=o[p];e.__plotgroup.circle(d).dx(s[0]-d/2).dy(s[1]-d/2).addClass(a.s["class"]+"__dot chartress__dot--"+t).stroke({color:l,width:i}).fill("white")}()}},a.drawColumns=function(){a.draw_columns=[];for(var s=a.s.maxLength,e=a.s.width/s,t=0;t<s;t++){a.draw_columns[t]=a.draw.group().addClass(a.s["class"]+"__columns__group "+a.s["class"]+"__columns__group--"+t);var l=e*t+a.s.graph.padding.left,i=a.s.columns.labels.y,o=0;for(var r in a.o.dataset){var n=a.o.dataset[r];a.log(n);var d=n.name||(t+1).toString();"object"==typeof d&&(d=d[t]);var p=n.color||"#222",g=n.textColor||p,h=n.classname||d.replace(/ /g,"_").toLowerCase(),x=a.s.columns.width,c=a.s.columns.space,_=n.__plot[t]/a.s.largestcolumn*a.s.height,f=a.o.dataset.length*-.5+.5+o,u=f*(x+c);a.log([f,u]),a.draw_columns[t].text(d).fill(g).dx(l+e/2+u).dy(a.s.height+i+a.s.graph.padding.top).font({family:a.s.fontFamily,anchor:"middle",size:a.s.columns.labels.fontsize}).addClass(a.s["class"]+"__columns__label "+a.s["class"]+"__columns__label--"+h),a.draw_columns[t].rect(x,_).fill(p).dx(l+e/2+u-x/2).dy(a.s.height-_+a.s.graph.padding.top).addClass(a.s["class"]+"__columns__column "+a.s["class"]+"__columns__column--"+h),o++}}},a.drawPies=function(){var s=0;a.pies={},a.draw_pie=a.draw.group().addClass(a.s["class"]+"__pies");var e=a.s.width<a.s.height?a.s.width:a.s.height,t=a.s.width/2-e/2+a.s.rect.left,l=a.s.height/2-e/2+a.s.rect.top,i=a.s.pie.total,o=0;if(null===i){i=0;for(var r in a.o.dataset){var n=a.o.dataset[r];i+=n.value}}var d;for(r in a.o.dataset)!function(){var n=a.o.dataset[r],p=200-10*s,g="rgb("+p+","+p+","+p+")",h=!1;"object"==typeof n.color&&(h=a.draw_pie.gradient("radial",function(s){s.at(0,n.color[0]),s.at(1,n.color[1])}),h.from("50%","50%").to("50%","50%").radius("50%"));var x=0,c=-90+x;"number"==typeof n.position?(n.position>1&&(n.position=n.position/100),x=360*n.position):0!==o&&(x=o/i*360),"number"!=typeof n.position&&(o+=n.value),c=-90+x;var _=n.classname||"noclass-"+s,f=e;"undefined"!=typeof n.width&&(f=n.width);var u=a.draw_pie.circle(e);u.fill("transparent").addClass(a.s["class"]+"__pie").dx(t).dy(l).stroke({width:f,color:"white"});var m=2*Math.PI*(e/2);u.rotate(c),d=a.draw_pie.circle(e).fill({color:"white"}).dx(t).dy(l),u.maskWith(d);var y=n.value*m/i;u.attr("stroke-dasharray",y+","+m),a.pies[_]=a.draw_pie.circle(e).fill(n.color||g).dx(t).dy(l),h&&a.pies[_].fill(h),a.pies[_].maskWith(u),s++}();var p=a.s.pie.title;if(p.text!==!1){a.draw_pie_title=a.draw_pie.group().addClass(a.s["class"]+"__pie__title");var g=a.draw_pie_title.text(p.text).addClass(a.s["class"]+"__pie__title--main").font({family:a.s.fontFamily,size:p.size,anchor:"middle"}).dx(a.s.width/2+a.s.graph.padding.left).dy(a.s.height/2+a.s.graph.padding.top-.9*p.size);p.bold&&g.font({family:a.s.fontFamily,weight:"bold"});var h=p.pre;p.pre.text&&a.draw_pie_title.text(h.text).addClass(a.s["class"]+"__pie__title--pre").font({family:a.s.fontFamily,size:h.size,anchor:"middle"}).dx(a.s.width/2+a.s.graph.padding.left).dy(a.s.height/2-p.size/2-h.size-5+a.s.graph.padding.top);var x=p.sub;p.sub.text&&a.draw_pie_title.text(x.text).addClass(a.s["class"]+"__pie__title--sub").font({family:a.s.fontFamily,size:x.size,anchor:"middle"}).dx(a.s.width/2+a.s.graph.padding.left).dy(a.s.height/2+p.size/2.5+a.s.graph.padding.top)}},a.drawLegend=function(){a.draw_legend=a.draw.group().addClass(a.s["class"]+"__legend").font({family:a.s.fontFamily,size:12});var s=a.s.outerWidth/100*a.s.legend.x;a.s.legend.x>50?s-=a.s.legend.padding.right:s+=a.s.legend.padding.left;var e=a.s.outerHeight/100*a.s.legend.y;a.s.legend.y<50?e+=a.s.legend.padding.top:e-=a.s.legend.padding.bottom,a.draw_legend.width(a.s.outerWidth).dmove(s,e);var t=0;for(var i in a.o.dataset)!function(){var s=a.o.dataset[i];if(s.name){var e=s.classname||s.name.toLowerCase().replace(/ /g,"_"),o=s.color||"black",r=s.width||2;s.__legend=a.draw_legend.group().addClass(a.s["class"]+"__legend__row chartress__legend--"+e).attr("plot-name",e);var n=s.name,d=s.__legend.text(n).fill(o).font({family:a.s.fontFamily}),p=(parseInt(l(d.node).width,10)+40)*-1-5,g=parseInt(l(d.node).height,10)*t-9;d.dx(p),d.dy(g);var h=s.rad||6,x=parseInt(l(d.node).height,10)/2+1,c=parseInt(l(d.node).height,10)*t+x,_=[[-35,c],[-5,c]],f=s.__legend.polyline(_).fill("none").stroke({color:o,width:r}).addClass(a.s["class"]+"__line chartress__legend__line chartress__legend__line--"+e);s.dash&&f.attr("stroke-dasharray",s.dash),s.__legend.circle(h).stroke({width:r,color:o}).fill("white").dx(0-h/2-5).dy(c-h/2).addClass(a.s["class"]+"__dot chartress__legend__dot--"+e),s.__legend.mouseover(function(){s.__plotgroup.addClass(a.s["class"]+"__plot--hover")}).mouseout(function(){s.__plotgroup.removeClass(a.s["class"]+"__plot--hover")}),t++}}()},a.drawChart=function(){a.clear(),a.setBounds(),"line"===a.s.type&&(a.drawLabels(),a.drawLines(),a.drawLegend()),"column"===a.s.type&&(a.drawLabels(),a.drawColumns()),"pie"===a.s.type&&a.drawPies(),setTimeout(function(){a.draw.spof()})},a.canvasResize=function(){a.drawChart(),a.draw.spof()};var h,x=[parseInt(l(g).width,10),parseInt(l(g).height,10)];return SVG.on(window,"resize",function(){x[0]===parseInt(l(g).width,10)&&x[1]===parseInt(l(g).height,10)||(clearTimeout(h),h=setTimeout(a.canvasResize,a.s.graph.redrawTimeout))}),a.drawToCanvas=function(e){var t=s.querySelector("svg"),l=e.getContext("2d");l.canvas.width=a.s.outerWidth,l.canvas.height=a.s.outerHeight;var i=new Image,o=(new XMLSerializer).serializeToString(t),r=btoa(o),n="data:image/svg+xml;base64,",d=n+r;i.src=d,l.drawImage(i,0,0)},a.drawChart(),a};